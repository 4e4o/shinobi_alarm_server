hikvisiob ip камеры умеют детектить движение и отдавать эвенты по tcp. Протокол на tcp порту 8000 бинарный, для написания клиентов используется net sdk hikvision которую можно у них на сайте скачать, что и было сделано. Далее был написан простой клиент который получал эвенты детекта движения - всё ок, всё работало, НО. Это сдк сраное китайское создаёт 130!!!! потоков блять! И грузит проц аж на 2% и памяти жрёт. Китайские говнокодеры опять постарались. Вобщем чтоб нахуй послать это сдк я сделал следующее. Создал прокси tcp сервер отдельной программулиной на c++ бусте, к нему уже клиент подключается. Прокси сервер же подключается к камере. После того как клиент авторизовался и там свои протокольные проприетарные штучки выполнил он завершается (пока, уёбище), и прокси сервер завершается при этом перехватывая эвент сокет от камеры с детекцией движения и уже по полученным данным от камеры детектит мошн детекшн пакеты (детект сделан примитивный по размеру полученных данных от камеры) В такой схеме клиент со своим тупым сдк сдыхает после авторизации а прокси программулина пашет, не потребляя нихуя при этом. cpu 0%, mem %0. Да и чему там потребляться то блять при одном сокете в программулине? Ай китайцы, китайцы...

Прокси при получении эвентов движения создаёт рандомные файлы в /dev/shm/streams/dropInEvents. Далле шиноби детектит новые файлы и тригерит запись. Шиноби тоже пришлось пропатчить чтоб он поддерживал детект новых файлов без фтп сервера.
